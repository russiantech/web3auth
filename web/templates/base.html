<!DOCTYPE html>
<html lang="en" class="light-style layout-menu-fixed" dir="ltr" 
data-theme="theme-default" data-assets-path="./static/" data-template="vertical-menu-template-free">
<head>
    <title>{% block title %} Web3 Secur Auth. {% endblock title %}</title>
    {% include 'incs/metas.html' %}
    {% block page_css %} {% endblock page_css %}
    {{ moment.include_moment() }}
</head>
<body>

    {% block content %}

    {% endblock content %}

    {% include "incs/response_modal.html" %}
    
    <!-- Core JS -->
    {% include 'incs/bottom_js.html' %}
    
    {% block page_js %}  {% endblock page_js %}
    
    <script>
        function response_modal(message) {
            document.getElementById('response_text').innerText = message;
            $('#response_modal').modal('show');
        }
    
        function showMessage(message, type = 'success') {
            const messageDiv = document.getElementById('message');
            const attendanceText = document.getElementById('attendance-text');
            attendanceText.innerText = `${message}`;
        }
        
    
        $(document).on('click', '#impersonate', function (){
            var user_id = $(this).data('user-id');
            var action = $(this).data('action');
            $.ajax({
                url: `/impersonate`,
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({
                    user_id: user_id,
                    action: action
                }),
                success: function(data) {
                    if (data.success) {
                        response_modal(data.message);
                        console.log(data);
                        if (action === 'revert') {
                            window.location.reload();  // Reload the page to update the view for the original user
                        } else {
                            window.location.href = './';  // Redirect to the dashboard or another page after impersonation
                        }
                    } else {
                        response_modal(data.error);
                        console.error('Error:', data.error);
                    }
                },
                error: function(xhr, status, error) {
                    response_modal(error);
                    console.error('Error:', error);
                }
            });
        });
    
    </script>

</body>
</html>